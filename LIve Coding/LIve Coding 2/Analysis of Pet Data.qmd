---
title: "Problem Class 2"
author: "Dr. Karim Anaya-Izquierdo"
format: html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(lubridate)
library(ggplot2)
library(patchwork)
```

## Background

The Utopian charity *Respect for Pets* has collected data on cats and dogs for 1990-2023. Utopia only allows three dog breeds: Beagle, Dachshund and Maltese. In Utopia all pets have to be registered. The charity would like to gain some insight regarding the following questions:

1) How have the numbers of dogs and cats changed over time? 

2) How has the popularity of the different dog breeds evolved since 1990?

3) Maltese are known to experience respiratory issues, such as wheezing or asthma. How does temperature affect the risk of a Maltese experiencing these issues?

This problem class is inspired by a question on last year's MA20277 Coursework 1, which almost used the exact same data. We will explore how we can apply the techniques seen so far to solve the three questions. 

## Data Descriptions

We are provided with two data files for the analysis:

**Pets.csv**: Information on the number of registered pets at the beginning of each month for January 1990 until September 2023:

* **Year**, **Month**: Year and month

* **Beagles**: Number of beagles

* **Dachshund**: Number of dachshunds 

* **Maltese**: Number of Maltese

* **Cats**: Number of cats


**Cases.csv:** Number of Maltese treated by a vet for respiratory issues for 1990-2022:

* **Date**: Date (day, month and year)

* **Temperature**: Daily maximum temperature in degree Celsius

* **Number**: Number of Maltese admitted with respiratory issues


##  Number of dogs and cats over time

We start by loading the data into our R Workspace using the read.csv() function and looking at the loaded data,

```{r}
Pets <- read.csv("Pets.csv")
glimpse( Pets )
```

**Task 1:** Which type of plot may be useful to explore how the numbers of dogs and cats have changed over time?

Before we create the plot, we need to do some data cleaning and wrangling. We start by converting the information on year and month into a variable of type **Date**. We can use the function **ym()** from the lubridate package for this:

```{r}
Pets <- Pets %>% 
  mutate( Date = paste( Year, Month, sep="-" ) ) %>%
  mutate( Date = ym( Date ) )
```

Since we want to plot the total number of dogs, we further create a variable **Dogs** which contains this information:

```{r}
Pets <- Pets %>% mutate( Dogs = Beagles + Dachshund + Maltese )
```

**Task 2:** Produce a plot which illustrates how the numbers of cats and dogs have changed over time. 

**Task 3:** What do we conclude from the plot produced in Task 2?

## Popularity of dog breeds

We now turn our attention to the second research question.

**Task 4:** How would you define popularity of a dog breed?

**Task 5:** Create a plot (or plots) to explore how popularity for the three different dog breeds has evolved over time.

**Task 6:** What do you conclude from your plot(s) created in Task 5?

## Effect of temperature on respiratory issues

The file "Cases.csv" provides information on the daily temperature and number of Maltese with respiratory issues. So we start by loading this file:

```{r}
Cases <- read.csv( "Cases.csv", header=TRUE )
```

**Task 7:** Explain why plotting the daily temperature against the number of dogs admitted with respiratory issues is not a good approach. What may be a better approach to address this question?

One possible approach is the following:

```{r, fig.align='center', out.width='60%', warning=FALSE, message=FALSE, fig.height=4, fig.width=6}
Maltese <- Pets %>% select( Year, Month, Maltese )

Cases <- Cases %>% 
  mutate( Year=year(Date), Month=month(Date) ) %>%
  full_join( Maltese, by=c( "Year"="Year", "Month"="Month" ) ) %>%
  mutate( Proportion = Number / Maltese )

ggplot( Cases, aes(x=Temperature, y=Proportion) ) + 
  geom_point() + geom_smooth() + 
  labs( y="Proportion of Maltese with respiratory issues" )
```

**Task 8:** What do we conclude from the plot? Which assumptions did we make in our analysis?
