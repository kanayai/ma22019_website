---
title: "Analysis of Tuscany Data Set"
date: "05/02/2025"
format: html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Loading the dplyr R package and the data 

```{r, warning=FALSE, message=FALSE}
library(dplyr)
Tuscany_raw <- read.csv("tuscany.csv" )
```

## Task 1: Compare populations for the different provinces and towns

### Explore the data and remove unncessary variables

Print first five data entries:

```{r}
slice_head( Tuscany_raw, n=5 )
```


**Method 1 - keep relevant variables:**

```{r}
Tuscany <- select( Tuscany_raw, Town:Women )
```

**Method 2 - remove variables which are not important for the analysis:**

```{r, eval=F, echo=TRUE}
Tuscany <- select( Tuscany_raw, -Year, -Postal_Code )
```

### Create a variable which represents population 

```{r}
Tuscany <- mutate( Tuscany, Population = Men + Women )
slice_head( Tuscany, n=5 )
```

### The pipe %>%

**We can combine the previous commands into a single piece of code using %>%:**

```{r}
Tuscany <- Tuscany_raw %>%
  mutate( Population = Men + Women ) %>%
  select( -Year, -Postal_Code )
slice_head( Tuscany, n=5 )
```

### Summarizing the data

We use summarize() to extract summaries for three variables

```{r}
Tuscany %>%
  summarize( "Population_Tuscany_2020" = sum( Population ),
             "Men_Tuscany_2020" = sum( Men ),
             "Women_Tuscany_2020" = sum( Women ) )
```

### Derive the population for each province

We combine summarize() and group_by():

```{r}
Tuscany_Province <- Tuscany %>%
  group_by( Province ) %>%
  summarize( Total = sum(Population) )
Tuscany_Province
```


### Sort provinces based on population

We use the arrange() function:

**To sort in ascending order:**

```{r}
arrange( Tuscany_Province, Total )
```

**To sort in descending order:**

```{r}
Tuscany_Province %>% arrange( desc(Total) )
```


## Task 2: Explore age profile of the population

Extract proportion of women at various ages:

```{r}
Tuscany_Women_Age <- Tuscany %>%
  group_by( Age ) %>%
  summarize( Number = sum(Women) ) %>%
  mutate( Proportion = Number / sum(Number) )
```

Visualize the proportions:

```{r, fig.align='center', out.width='70%', fig.height=4, fig.width=6}
barplot( Proportion~Age, data=Tuscany_Women_Age )
```
