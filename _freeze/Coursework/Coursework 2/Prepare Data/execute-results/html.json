{
  "hash": "f5ea3d156a31a303d39f4742d806954d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Coursework 2 Data Preparation\"\nauthor: \"Dr. Karim Anaya-Izquierdo\"\ndate: \"April 2025\"\nformat: html\n---\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidytext)\nlibrary(sf)\nlibrary(stringr)\nlibrary(tidyr)\nlibrary(mvtnorm)\nlibrary(sp)\nlibrary(gstat)\nlibrary(lubridate)\n```\n:::\n\n\n## Question 1\n\n### Create data set of fakes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nFake1 <- readLines(\"Original Data/Downtrodden Poet.txt\", encoding = \"UTF-8\")\nFake2 <- readLines(\"Original Data/Fallen Gentleman.txt\", encoding = \"UTF-8\")\nFake3 <- readLines(\"Original Data/MisersToll.txt\", encoding = \"UTF-8\")\nFake4 <- readLines(\"Original Data/Orphans Heart.txt\", encoding = \"UTF-8\")\nFake5 <- readLines(\"Original Data/Shopkeepers Lament.txt\", encoding = \"UTF-8\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nFake1 <- data.frame( Title=\"The Downtrodden Poet\", Text=Fake1 )\nFake2 <- data.frame( Title=\"The Fallen Gentleman\", Text=Fake2 )\nFake3 <- data.frame( Title=\"The Miser’s Toll\", Text=Fake3 )\nFake4 <- data.frame( Title=\"The Orphan’s Heart\", Text=Fake4 )\nFake5 <- data.frame( Title=\"The Shopkeeper's Lament\", Text=Fake5 )\nFakes <- rbind( Fake1, Fake2, Fake3, Fake4, Fake5 )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv( Fakes, \"Dickens_Fakes.csv\", row.names = FALSE, fileEncoding = \"UTF-8\" )\n```\n:::\n\n\n### Create data set of originals\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDickens <- read.csv(\"Original Data/Dickens.csv\", encoding = \"UTF-8\")\nDickens_chapters <- Dickens %>%\n  group_by( title ) %>%\n  mutate( chapter = cumsum( \n    str_detect( text, regex( \"^chapter \", ignore_case = TRUE ) ) \n  ) )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDickens_chapters <- Dickens_chapters %>%\n  filter( chapter > 0 ) %>%\n  unite( col=document, title, chapter )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2025)\nsamp <- sample( unique(Dickens_chapters$document), size = 10, replace = FALSE )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDickens_originals <- Dickens_chapters %>%\n  filter( document %in% samp ) %>%\n  separate( document, c(\"Title\", \"Chapter\"), sep=\"_\", convert=TRUE ) %>%\n  rename( Text = text)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv( Dickens_originals, \"Dickens_Originals.csv\", row.names = FALSE, \n           fileEncoding = \"UTF-8\" )\n```\n:::\n\n\n\n## Question 2\n\n### Create shapefile and point locations\n\n\n::: {.cell}\n\n```{.r .cell-code}\nUK <- read_sf(\"Original Data/UK Shapefile/UK_admin.shp\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSomerset <- filter( UK, NAME_2 == \"North Somerset\")\nSomerset <- Somerset %>% select( geometry )\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nset.seed(2025)\nSomerset_coords <- st_coordinates(Somerset$geometry)\nSomerset_coords[,1] <- 0.5 * Somerset_coords[,1] + 100\nSomerset_coords[,2] <- 0.5 * Somerset_coords[,2] - 10\nShapefile <- st_sfc( st_polygon(list(Somerset_coords[,1:2]) ))\nst_crs(Shapefile) <- 4326\nwrite_sf( Shapefile, \"Tesremos.shp\")\nShapefile <- st_sfc( st_polygon(list(Somerset_coords[,1:2]) ))\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2025)\nmargins <- st_bbox(Shapefile)\nnum_loc <- 200\ncoords <- cbind( runif( num_loc, margins[1], margins[3] ),\n                 runif( num_loc, margins[2], margins[4] ) )\ncoords <- st_sfc( st_multipoint( coords ) ) %>% st_cast( \"POINT\" )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nind <- st_intersects(coords, Shapefile)\nind <- which( as.vector(ind)[1:200] == 1 )\ncoords <- coords[ind,]\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLocations           <- data.frame( ID=1:length(coords) )\ntemp                <- st_coordinates( coords )\nLocations$Longitude <- round(temp[,1],5)\nLocations$Latitude  <- round(temp[,2],5)\nLocations <- Locations %>% \n  arrange( Longitude )\nfor( i in 1:nrow(Locations) )\n  Locations$ID[i] <- paste(\"Site_\",i,sep=\"\")\nwrite.csv( Locations, \"Tesremos_Locations.csv\", row.names = FALSE )\n```\n:::\n\n\n\n### Create observations for March\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(850)\nWater <- Locations %>% select( Longitude, Latitude )\nDistance <- as.matrix( dist(Water, upper = TRUE, diag = TRUE ) )\nSigma <- 7 * exp( -15*Distance )\nZ <- rmvnorm( 1, mean = rep(-20,length(Water$Longitude)), sigma=Sigma )\nWater$Anomaly <- Z[1,]\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2000)\nSigma <- 0.2 * exp( -9*Distance )\nZ <- rmvnorm(31, mean = rep(0,nrow(Water)), sigma=Sigma )\n\nWater_March <- matrix( 0, 31, nrow(Water) )\nfor( i in 1:31 )\n  Water_March[i,] <- Water$Anomaly + Z[i,]\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWater_March <- as.data.frame(round(Water_March,2))\nfor( i in 1:nrow(Locations) )\n  names(Water_March)[i] <- paste(\"Site_\",i,sep=\"\")\nWater_March <- Water_March %>%\n  mutate( Date = as_date(\"01/03/2024\", format=\"%d/%m/%Y\") + 0:30 ) %>%\n  relocate(Date, .before=Site_1 )\n```\n:::\n\n\n### Create observations for August\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWater <- Locations %>% \n  select( Longitude, Latitude ) %>%\n  mutate( Longitude = min(Longitude) + 5 * \n            ( Longitude-min(Longitude) > 0.09 ) *\n            ( Longitude - min(Longitude) ) )\nDistance <- as.matrix( dist(Water, upper = TRUE, diag = TRUE ) )\n\nset.seed(1000)\nSigma <- 9 * exp( -9*Distance )\nZ <- rmvnorm(1, mean = rep(-25,nrow(Water)), sigma=Sigma )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWater <- Water %>% \n  mutate( Longitude = Locations$Longitude, Anomaly=Z[1,] )\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(3000)\nSigma <- 0.2 * exp( -9*Distance )\nZ <- rmvnorm(31, mean = rep(0,nrow(Water)), sigma=Sigma )\n\nWater_August <- matrix( 0, 31, nrow(Water) )\nfor( i in 1:31 )\n  Water_August[i,] <- Water$Anomaly + Z[i,]\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWater_August <- as.data.frame(round(Water_August,2))\nfor( i in 1:nrow(Locations) )\n  names(Water_August)[i] <- paste(\"Site_\",i,sep=\"\")\nWater_August <- Water_August %>%\n  mutate( Date = as_date(\"01/08/2024\", format=\"%d/%m/%Y\") + 0:30 ) %>%\n  relocate(Date, .before=Site_1 )\nWater <- bind_rows( Water_March, Water_August)\nwrite.csv(Water, \"Tesremos_Water.csv\", row.names = FALSE )\n```\n:::\n\n\n\n## Question 3\n\n## Create the \"Isles of Sofara\"\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nROM <- read_sf( \"Original Data/Romania Shapefile/gadm41_ROU_1.shp\" )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(20000)\nIslands <- ROM[sample(1:42,5),] %>% select( NAME_1, geometry )\nIslands$NAME_1   <- c( \"Paxora\", \"Solvenya\", \"Justitia\", \"Calmorra\", \"Ecliptria\" )\nIslands$geometry <- st_geometry(Islands) + c(-50,-30)\nst_crs(Islands)  <- 4326\nIslands          <- Islands %>% \n  st_simplify( dTolerance = 100) %>%\n  rename( Name=NAME_1 )\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nIslands_centroids <- st_centroid(Islands)\nggplot(Islands) + geom_sf() + theme_bw() + \n  geom_sf_text( data=Islands_centroids, aes(label = Name), color=\"darkblue\" ) + \n  labs( x=\"Longitude\", y=\"Latitude\" )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_sf( Islands, \"Isles_of_Sofara_Shapefile/Isles_of_Sofara.shp\" )\n```\n:::\n\n\n\n## Import messages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2025)\nDistress <- read.csv(\"Original Data/DistressMessages.csv\", encoding = \"UTF-8\", header = TRUE) %>%\n  rename( Message = Distress.Message) %>%\n  mutate( Message = paste(\"#IoSTSHelp\", Message, sep=\" \") )\nReports <- read.csv(\"Original Data/StormMessages.csv\", encoding = \"UTF-8\", header=TRUE) %>%\n  rename( Message = Storm.Message)\nMessages <- bind_rows( Distress, Reports )\nMessages <- Messages[sample(1:nrow(Messages)),]\n```\n:::\n\n\n\n\n## Simulate locations of disasters\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMessages <- data.frame( Message = Messages )\nIsland_names <- c( \"Paxora\", \"Solvenya\", \"Justitia\", \"Calmorra\", \"Ecliptria\" )\nMessages <- Messages %>%\n  mutate( Longitude = rep(0,nrow(Messages)),\n          Latitude = rep(0,nrow(Messages)),\n          Island = rep(\"Paxora\", nrow(Messages) ) )\n\n\nset.seed(4000)\ncentres <- st_coordinates(Islands_centroids)\nk <- 1\n\nwhile( k <= nrow(Messages) ){\n  centre_i <- centres[sample(1:5,1),]\n  centre_i <- centre_i + rnorm(2,0,0.3)\n  num_messages <- rgeom( 1, 0.02 )\n  for( j in 1:num_messages ){\n    if( k>nrow(Messages) )\n      next;\n    Messages$Longitude[k] <- round( runif(1, centre_i[1]-0.5, centre_i[1]+0.5), 4)\n    Messages$Latitude[k]  <- round( runif(1, centre_i[2]-0.5, centre_i[2]+0.5), 4 ) \n    loc_sfc <- st_sfc( st_point( c(Messages$Longitude[k], Messages$Latitude[k]) ) )\n    st_crs(loc_sfc)  <- 4326\n    if( !is.na( st_intersects(loc_sfc, Islands)[1] > 0 ) ){\n      Messages$Island[k] <- Island_names[st_intersects(loc_sfc, Islands)[1][[1]]]\n      if( rbinom( 1,1,0.05) == 1 ){\n        Messages$Longitude[k] <- NA\n        Messages$Latitude[k]  <- NA \n      }\n      k <- k+1\n    }\n  }\n}\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv( Messages, \"Isles_of_Sofara_Messages.csv\", row.names = FALSE )\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}