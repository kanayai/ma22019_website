{
  "hash": "f930ae9d6f623329501163428627db61",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Switching Data Formats Example\"\nauthor: \"Christian Rohrbeck\"\ndate: \"19/02/2025\"\nformat: html\n---\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lubridate)\nlibrary(ggplot2)\nlibrary(dplyr)\n```\n:::\n\n\n\n## Load the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nManaus <- read.csv(\"data/manaus_temperature.csv\" )\n```\n:::\n\n\n## Case 1 - Comparison months\n\n### Data Cleaning\n\n\n::: {.cell}\n\n```{.r .cell-code}\nManaus <- Manaus %>% \n  mutate( JAN = na_if( JAN, 999.9 ), FEB = na_if( FEB, 999.9 ) )\n```\n:::\n\n\n### Plotting the data\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nManaus %>% \n  filter( JAN < 100, FEB < 100 ) %>%\n  ggplot( aes(x=JAN, y=FEB) ) + geom_point() + \n  labs(x=\"Temperature in January\", y=\"Temperature in February\") + \n  theme_bw() +\n  theme( axis.title=element_text(size=16), \n         axis.text=element_text(size=14) )\n```\n\n::: {.cell-output-display}\n![](change_in_data_structure___example_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=50%}\n:::\n:::\n\n\n## Case 2 - Analyse change over time\n\n### Changing the data structure\n\nThe data format is not good for creating a line plot of temperature over time. Sow e have to change the format:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\nManaus_long <- Manaus %>%\n  pivot_longer(cols = JAN:DEC, names_to = \"Month\" )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(Manaus_long)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,320\nColumns: 3\n$ YEAR  <int> 1910, 1910, 1910, 1910, 1910, 1910, 1910, 1910, 1910, 1910, 1910…\n$ Month <chr> \"JAN\", \"FEB\", \"MAR\", \"APR\", \"MAY\", \"JUN\", \"JUL\", \"AUG\", \"SEP\", \"…\n$ value <dbl> 27.3, 27.0, 26.5, 26.2, 27.2, 27.5, 27.7, 28.0, 29.0, 28.3, 28.3…\n```\n\n\n:::\n:::\n\n\nTo reverse the process and convert the longer to the wider format, we use pivot_wider():\n\n\n::: {.cell}\n\n```{.r .cell-code}\nManaus_short <- Manaus_long %>%\n  pivot_wider( names_from = Month, values_from = value)\n```\n:::\n\n\n### Plotting the data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Convert abbreviation for month into number\nManaus_long <- \n  Manaus_long %>% \n  mutate( Month = case_when( \n    Month == \"JAN\" ~ \"01\", Month == \"FEB\" ~ \"02\", Month == \"MAR\" ~ \"03\", \n    Month == \"APR\" ~ \"04\", Month == \"MAY\" ~ \"05\", Month == \"JUN\" ~ \"06\",\n    Month == \"JUL\" ~ \"07\", Month == \"AUG\" ~ \"08\", Month == \"SEP\" ~ \"09\", \n    Month == \"OCT\" ~ \"10\", Month == \"NOV\" ~ \"11\", Month == \"DEC\" ~ \"12\"\n    ) \n  )\n\n## Combine year and month and convert to date\nManaus_long <- Manaus_long %>%\n  mutate( Date = paste( Manaus_long$YEAR, Manaus_long$Month, sep=\"-\" ) ) %>%\n  mutate( Date = ym( Date ) )\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nManaus_long %>%\n  mutate( value = na_if( value, 999.9 ) ) %>%\n  ggplot( aes(\"x\"=Date, \"y\"=value) ) + \n  geom_line() + geom_smooth() +\n  labs( y=\"Average Monthly Temperature\") + theme_bw() +\n  theme( axis.title=element_text(size=16), axis.text=element_text(size=14) )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = \"cs\")'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Average monthly temperature for Manaus, Brazil, between 1910 and 2019.](change_in_data_structure___example_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=55%}\n:::\n:::\n\n",
    "supporting": [
      "change_in_data_structure___example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}