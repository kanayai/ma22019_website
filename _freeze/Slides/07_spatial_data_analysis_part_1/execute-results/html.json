{
  "hash": "ce1330f0fa4b397be875dc20984bd4e8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Spatial Data Analysis (Part 1)\"\nsubtitle: \"Lecture\"\ndate: \"19 March 2025\"\n---\n\n\n\n::: {.cell}\n\n:::\n\n\n## Plan for Today\n\nWe start the final chapter on spatial data analysis:\n\n* Types of spatial data\n\n* Visualization of point-referenced data (Section 4.1)\n\n* Problem Class 5\n\n* Inverse Distance Weighting (Section 4.2)\n\n* Comments on Coursework 1\n\n## Motivation \n\nIn many applications we have spatial information:\n\n- Air pollution modelling\n\n- Disease outbreaks\n\n- Ecological studies\n\n- Socioeconomic studies\n\n- Weather data\n\n\n**<span style='color: blue;'>How can we use this information in a data analysis?</span>**\n\n\n\n## Types of Spatial Data I \n\nIn spatial data analysis we consider **three** types of spatial data:\n\n\n**Point-referenced data**\n\n- Data are observed across a number of fixed sites\n\n- Meteorology and mining are text book examples for this type of data\n\n\n## Types of Spatial Data II \n\n\n**Point-pattern data**\n\n- Spatial locations are random variables\n\n- Often found when analyzing disease outbreaks and in ecological studies\n\n\n\n**Lattice / Areal unit data**\n\n- Our sites are fixed areas (countries, counties, etc.)\n\n- Examples include insurance claims and **image data**\n\n\n# Visualizing point-referenced data\n\n## Motivation \n\n\nLet's look at some temperature data for Germany\n\n**<span style='color: blue;'>-> Quarto Document</span>**\n\n\n\n\nJust using ggplot2 does not really provide a useful plot.\n\n**Would a map provide additional information?**\n\n\n## Shapefiles\n\nOne option is to add the boundaries of Germany.\n\nSuch data is available via the website <a href=\"https://gadm.org/\">gadm.org</a>.\n\nLet's see how we can add such shapefile data to our plot </br>\n\n**<span style='color: blue;'>-> Quarto Document</span>**\n\n## Projections  \n\n\nWe used latitude and longitude within a Cartesian coordinate system. \n\n**However**, the earth is not flat!\n\n\n\nConverting locations on earth to a two-dimensional representation is called a **projection**.\n\nWe can choose a projection using the **coord_sf()** function.\n\n**<span style='color: blue;'>-> Quarto Document</span>**\n\n\n## Example\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](07_spatial_data_analysis_part_1_files/figure-revealjs/unnamed-chunk-2-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n## Remarks about projections\n\n- **WGS84 coordinate reference system** is the standard for GPS systems and Google Earth and has **st_crs(4326)**\n\n- The projection may have a influence on how the plot is perceived\n\n- Some projections are better for some parts of the world than for others\n\n- For small areas we usually don't need to consider projections.\n\n- When using projections, we also need to project the points\n\n**<span style='color: blue;'>-> Quarto Document</span>**\n\n## Creating maps with ggspatial\n\n\nIt may be better to place points on a (colourful) map.\n\nThis will be achieved by importing OpenStreetMap data using the package **ggspatial()**\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggspatial)\nlibrary(prettymapr)\n```\n:::\n\n\n\n\n**How to make it work**\n\n1) Add the function \"annotation_map_tile()\"\n\n2) Replace **geom_point()** by **geom_spatial_point()**\n\n**<span style='color: blue;'>-> Quarto Document</span>**\n\n\n\n# Problem Class 5\n\n## Exercise\n\nPlease go to Moodle and download the materials for Problem Class 5.\n\n# Inverse Distance Weighting\n\n## Motivation \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](07_spatial_data_analysis_part_1_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=75%}\n:::\n:::\n\n\n<span style='color: blue;'>What is the temperature at an unobserved location?</span>\n\n## Notation\n\nWe introduce some notation to define our approach mathematically:\n\n- $n$ observations $x_1,\\ldots,x_n\\in\\mathbb{R}$\n\n- locations $\\mathbf{s}_1,\\ldots,\\mathbf{s}_n\\in\\mathbb{R}^2$\n\n- $\\mathbf{s}^*$ is the unobserved location for which we want to derive a prediction $x^*$\n\n**<span style='color: blue;'>How could we use the data and location information to get a prediction?</span>**\n\n## Inverse Distance Weighting \n\n\nLet $d: \\mathbb{R}^2 \\times \\mathbb{R}^2 \\to \\mathbb{R}_+$ be a distance metric, such as\n\n$$\nd(\\mathbf{s}_1, \\mathbf{s}_2) = \\|\\mathbf{s}_1-\\mathbf{s}_2\\|_2= \\sqrt{(s_{11}-s_{21})^2 + (s_{12}-s_{22})^2}.\n$$\n\n\nInverse distance weighting defines\n\n$$\nx^* = \n\\begin{cases}\n\\dfrac{\\sum_{i=1}^n w(\\mathbf{s}_i,\\mathbf{s}^*) x_i}{\\sum_{i=1}^n, w(\\mathbf{s}_i,\\mathbf{s}^*)} & \\mbox{if}~d(\\mathbf{s}^*, \\mathbf{s}_i)>0,\\\\\nx_i & \\mathrm{if}~d(\\mathbf{s}^*, \\mathbf{s}_i)=0,\n\\end{cases}\n$$\n\nwhere $w(\\mathbf{s}_i,\\mathbf{s}^*) = \\left[d(\\mathbf{s}_i,\\mathbf{s}^*)\\right]^{-p}$ and $p>0$ is called the **power parameter**. \n\n\n\n## Effect of the power parameter \n\n\nWe have to select a suitable value for $p$.\n\n**Example:** Suppose $\\mathbf{s}^* = (13.1, 51.0)$ for the German temperature data. \n\nLet's compare $p=0.5$, $p=2$ and $p=20$.\n\n**<span style='color: blue;'>-> Quarto Document</span>**\n\n\n\nIt may be useful to create a map of predicted values to:\n\n* Study spatial pattern of the values\n\n* Select a suitable value for $p$\n\n\n\n## Remarks\n\n- We only need a reasonable $p$, it does not have to optimal\n\n- The Euclidian distance for $d(\\mathbf{s}_1,\\mathbf{s}_2)$ is not necessarily the best choice\n\n    + **Example:** We ignored the aspect of altitude in our calculations\n\n- Be careful when making predictions for locations that are not close to at least one location in $\\{\\mathbf{s}_1, \\ldots,\\mathbf{s}_n\\}$\n\n## Summary\n\nToday we learned that\n\n- Spatial data occurs in several applications\n\n- There are **three** types of spatial data\n\n- We can use shapefiles and maps to visualize the data\n\n- When studying large areas, we have to consider the projection\n\n- Inverse distance weighting may be used for predicting values at unobserved locations\n\n# Coursework 1\n\n## Summary\n\n**Average: 58.7%**\n\n**Office Hour for questions on the coursework:**\n\n* Thursday (tomorrow): 12:30-15:00\n\n* Monday: 9:00-10:15 and 16:00-18:00\n\n**Advice for Coursework 2:** \n\n* Don't suppress the R code for loading packages\n\n* Make use of Quarto options to modify the size of plots.\n\n* Clearly describe your approach.\n\n## Reminder - What does it mean to be a data scientist\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](07_spatial_data_analysis_part_1_files/figure-revealjs/unnamed-chunk-5-1.png){fig-align='center' width=55%}\n:::\n:::\n\n",
    "supporting": [
      "07_spatial_data_analysis_part_1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}