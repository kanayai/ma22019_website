{
  "hash": "cd6c5fbf0c27a0a7a7222163e064462d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analysis of NRFA Data\"\ndate: \"12/02/2025\"\nformat: html\n---\n\n\n\n## Loading the data and R packages \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary( lubridate )\nlibrary( dplyr )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBathford <- read.csv(\"bathford_river_flow.csv\", skip=20, header=FALSE,\n                      colClasses = c(\"character\",\"numeric\",\"NULL\") ) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in read.table(file = file, header = header, sep = sep, quote = quote, :\ncols = 2 != length(data) = 3\n```\n\n\n:::\n:::\n\n\n## Data Cleaning\n\nCheck which variables need to converted and renamed\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse( Bathford )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 19,697\nColumns: 2\n$ V1 <chr> \"1969-10-27\", \"1969-10-28\", \"1969-10-29\", \"1969-10-30\", \"1969-10-31…\n$ V2 <dbl> 3.998, 3.958, 4.210, 4.480, 4.205, 3.830, 3.723, 3.986, 4.353, 4.52…\n```\n\n\n:::\n:::\n\n\n### Change variables names\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBathford <- rename( Bathford, Date = V1, RiverFlow = V2 )\n```\n:::\n\n\n### Convert to correct type\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBathford$Date <- as_date( Bathford$Date, format=\"%Y-%m-%d\" )\n```\n:::\n\n\n\n## Data Wrangling and visualization\n\n### Proportion of missing data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean( is.na( Bathford$RiverFlow ) )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.006244606\n```\n\n\n:::\n:::\n\n\n### Plot river flow over time\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot( Bathford$Date, Bathford$RiverFlow, type='l',\n      xlab=\"Date\", ylab=\"River Flow\", cex.lab = 1.5 )\n```\n\n::: {.cell-output-display}\n![](analysis_nrfa_data_for_bathford_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=60%}\n:::\n:::\n\n\n### Filter observations based on date and observed river flow\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBathford_High <- filter( Bathford, RiverFlow > 100 )\nslice_head( Bathford_High, n=5 )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Date RiverFlow\n1 1970-11-19     104.3\n2 1971-01-21     128.4\n3 1971-01-22     114.8\n4 1971-01-23     115.2\n5 1971-01-24     133.1\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBathford_High <- filter( Bathford, RiverFlow > 100, year(Date) > 1990 )\nslice_head( Bathford_High, n=5 )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Date RiverFlow\n1 1991-01-10     112.1\n2 1992-11-26     106.9\n3 1992-11-27     100.9\n4 1992-11-28     100.6\n5 1992-11-29     131.6\n```\n\n\n:::\n:::\n\n\n### Loading data for a second gauge at Bath\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBath <- read.csv(\"bath_river_flow.csv\", skip=19, header=FALSE,\n                  colClasses = c(\"character\",\"numeric\",\"NULL\") )\nBath <- Bath %>% rename( Date = V1, RiverFlow = V2 ) %>%\n  mutate( Date = as_date( Date, format=\"%Y-%m-%d\" ) )\nglimpse( Bath )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 17,196\nColumns: 2\n$ Date      <date> 1976-09-01, 1976-09-02, 1976-09-03, 1976-09-04, 1976-09-05,…\n$ RiverFlow <dbl> 3.39, 2.83, 2.97, 2.81, 2.90, 2.81, 2.59, 3.11, 2.78, 2.46, …\n```\n\n\n:::\n:::\n\n\nWe note that the gauge at Bath started recording river flow a few years after the gauge at Bathford.\n\nThis prevents us from analyzing the dependence in the river flow of the two students, for instance, using the covariance (introduced in Year 1 Probability & Statistics):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncov(Bath$RiverFlow, Bathford$RiverFlow)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in cov(Bath$RiverFlow, Bathford$RiverFlow): incompatible dimensions\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Merging the two data sets\n\nLet's merge observations based on **Date** and rename the variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRF <- full_join( Bathford, Bath, by=c(\"Date\" = \"Date\") ) %>%\n  rename( Bathford = RiverFlow.x, Bath = RiverFlow.y )\nslice_head(RF, n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Date Bathford Bath\n1 1969-10-27    3.998   NA\n2 1969-10-28    3.958   NA\n3 1969-10-29    4.210   NA\n4 1969-10-30    4.480   NA\n5 1969-10-31    4.205   NA\n```\n\n\n:::\n:::\n\n\nFirst observations for Bath are missing, since the gauge was not operational at that time.\n\n## Data analysis\n\nLet's explore the dependence of the river flow levels for the two gauges:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot( RF$Bath, RF$Bathford, pch=19,\n      xlab=\"River Flow at Bath\", ylab=\"River Flow at Bathford\" )\n```\n\n::: {.cell-output-display}\n![](analysis_nrfa_data_for_bathford_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=50%}\n:::\n:::\n\n\n\nWe can now calculate the covariance and correlation\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncov( RF$Bathford, RF$Bath,  use = \"complete\" )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 582.4116\n```\n\n\n:::\n\n```{.r .cell-code}\ncor( RF$Bathford, RF$Bath,  use = \"complete\" )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.9929988\n```\n\n\n:::\n:::\n\n\n## Comparison with inner_join()\n\nWhile full_join() keeps all observation, inner_join() only keeps the dates listed in both data sets\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRF <- inner_join( Bathford, Bath, by=c(\"Date\" = \"Date\") )\nslice_head(RF, n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Date RiverFlow.x RiverFlow.y\n1 1976-09-01       2.811        3.39\n2 1976-09-02       2.560        2.83\n3 1976-09-03       2.337        2.97\n4 1976-09-04       2.385        2.81\n5 1976-09-05       2.146        2.90\n```\n\n\n:::\n:::\n\n",
    "supporting": [
      "analysis_nrfa_data_for_bathford_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}