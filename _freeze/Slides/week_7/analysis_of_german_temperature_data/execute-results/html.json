{
  "hash": "91074fee5086c1afa90e1ef9026e246c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analysis of German Temperature Data\"\nauthor: \"Christian Rohrbeck\"\ndate: \"19/03/2023\"\nformat: html\n---\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary( dplyr )\nlibrary( ggplot2 )\nlibrary( sf )\nlibrary( ggspatial )\nlibrary( prettymapr )\n```\n:::\n\n\n## Loading the data and a first plot\n\nThe data are stored in the file \"Temperature Germany.csv\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTemperature <- read.csv(\"temperature_germany.csv\" )  \n```\n:::\n\n\nThe data provides spatial locations and maximum daily temperature:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse( Temperature )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 75\nColumns: 5\n$ name      <chr> \"Leuchtturm Alte Weser\", \"Dresden-Klotzsche\", \"D\\xfcsseldorf…\n$ latitude  <dbl> 53.86330, 51.11991, 51.28658, 54.19130, 48.35505, 50.97729, …\n$ longitude <dbl> 8.127500, 13.763200, 6.768267, 6.560675, 11.808000, 10.97638…\n$ altitude  <dbl> 32.0, 206.7, 36.4, 0.8, 443.9, 288.9, 1489.7, 1213.0, 111.5,…\n$ max.temp  <dbl> 18.9, 23.8, 28.7, 16.6, 25.6, 23.9, 17.1, 17.0, 26.3, 23.4, …\n```\n\n\n:::\n:::\n\n\n# Visualization of the data\n\n## Visualization using ggplot2 only\n\nUse colour as a visual cue for the temperature values and longitude and latitude for the x and y axis respectively:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot( Temperature, aes(x=longitude, y=latitude) ) +\n  geom_point( aes(color=max.temp), size=1.2 ) + theme_bw() + \n  scale_color_distiller( palette=\"Reds\", trans=\"reverse\" ) +\n  labs( x=\"Longitude\", y=\"Latitude\", color=\"Temperature\")\n```\n\n::: {.cell-output-display}\n![](analysis_of_german_temperature_data_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=50%}\n:::\n:::\n\n\n## Importing and plotting shapefiles\n\nWe load the shapefile with the read_sf() function\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGermany <- read_sf( \"gadm41_DEU_1.shp\" )\n```\n:::\n\n\nLet's slightly reduce the complexity of the shape\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGermany <- Germany %>% st_simplify( dTolerance = 2000 )\n```\n:::\n\n\nWe can plot the shape with\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot( Germany ) + geom_sf() + theme_bw() + \n  labs( x=\"Longitude\", y=\"Latitude\" )\n```\n\n::: {.cell-output-display}\n![](analysis_of_german_temperature_data_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nTime to combine the shapefile with the points \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot( Germany ) + geom_sf() + \n  geom_point( data=Temperature, aes(x=longitude, y=latitude,\n                                    color=max.temp), size=2 ) + \n  scale_color_distiller( palette=\"Reds\", trans=\"reverse\" ) +\n  theme_bw() + labs( x=\"Longitude\", y=\"Latitude\", color=\"Temperature\" )\n```\n\n::: {.cell-output-display}\n![](analysis_of_german_temperature_data_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n## Projections \n\nLet's apply a projection to the shapefile\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot( Germany ) + theme_bw() + geom_sf() + \n  coord_sf( crs=st_crs(3346) )\n```\n\n::: {.cell-output-display}\n![](analysis_of_german_temperature_data_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nWe can also store the projected shapefile\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGermany_projected <- st_transform( Germany, crs = 3346 )\n```\n:::\n\n\nWe also need to change the projection of the points if we wanted to plot on the projected surface. So we first convert them into a spatial object:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTemperature_projected <- st_as_sf( Temperature, coords=c(\"longitude\", \"latitude\"), crs=\"WGS84\" )\n```\n:::\n\n\nNow we are ready to plot the points\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot( Germany_projected ) + theme_bw() + geom_sf() +  \n  geom_sf( data=Temperature_projected, aes(color=max.temp), size=2 ) + \n  scale_color_distiller( palette=\"Reds\", trans=\"reverse\" ) +\n  theme_bw() + labs( x=\"Longitude\", y=\"Latitude\", color=\"Temperature\" )\n```\n\n::: {.cell-output-display}\n![](analysis_of_german_temperature_data_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nYou will see another example in Tutorial Question 2 on Problem Sheet 6.\n\n## Adding maps\n\nAn alternative to shapefiles is to use maps. We will use ggspatial for this:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot( Temperature, aes(x=longitude, y=latitude) ) +\n  annotation_map_tile() +\n  geom_spatial_point( aes(color=max.temp), size=2 ) + \n  scale_color_distiller( palette=\"Reds\", trans=\"reverse\" ) +\n  theme_bw() + labs( x=\"Longitude\", y=\"Latitude\", color=\"Temperature\" )\n```\n\n::: {.cell-output-display}\n![](analysis_of_german_temperature_data_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n\n# Inverse distance weighting\n\n## Function to perform inverse distance weighting\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIDW <- function( X, S, s_star, p){\n  d <- sqrt( (S[,1]-s_star[1])^2 + (S[,2]-s_star[2])^2 )\n  w <- d^(-p)\n  if( min(d) > 0 )\n    return( sum( X * w ) / sum( w ) )\n  else \n    return( X[d==0] )\n}\n```\n:::\n\n\n## Combine observations to define matrix for S\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoord <- cbind( Temperature$longitude, Temperature$latitude )\nIDW( X=Temperature$max.temp, S=coord, s_star= c( 13.1, 51.0 ), p=5 )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 19.9847\n```\n\n\n:::\n:::\n\n\n## Estimate values over a grid\n\n### Define the grid\n\n\n::: {.cell}\n\n```{.r .cell-code}\npoints_lat <- seq( 47.1, 55.1, by=0.05 )\npoints_lon <- seq( 5.8, 15.6, by=0.05 )\npixels <- as.matrix( expand.grid( points_lon, points_lat ) )\n```\n:::\n\n\n\n### Calculate values for difference choices of the power parameter \n\n\n::: {.cell}\n\n```{.r .cell-code}\np05 <- p2 <- p20 <- c()\nfor( j in 1:length(pixels[,1]) ){\n  p05[j] <- IDW( X=Temperature$max.temp, S=coord, s_star=pixels[j,], p=0.5 )\n  p2[j]  <- IDW( X=Temperature$max.temp, S=coord, s_star=pixels[j,], p=2.0 )\n  p20[j] <- IDW( X=Temperature$max.temp, S=coord, s_star=pixels[j,], p=20  )\n}\n```\n:::\n\n\n## Visualize grid of predicted values\n\n\n### Set up data frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\nPredict <- data.frame( \"Lon\"=pixels[,1], \"Lat\"=pixels[,2], \n                       \"p0.5\"=p05, \"p2\"=p2, \"p20\"=p20 )\nPredict <- Predict %>% pivot_longer( cols=p0.5:p20, names_to = \"Power\" )\nPredict <- Predict %>% \n  mutate( Power = case_when( Power == \"p0.5\" ~ \"p=0.5\", Power == \"p2\" ~ \"p=2.0\",\n                             .default = \"p=20\" ) )\n```\n:::\n\n\n### Visualize predictions together with a map\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot( data=Predict ) + theme_bw() +\n  geom_raster( aes( x=Lon, y=Lat, fill=value ) ) + \n  facet_wrap( ~Power ) + \n  scale_fill_distiller( palette=\"Reds\", trans=\"reverse\" ) +\n  geom_sf( data=Germany, alpha=0.0, color=\"white\" ) +\n  geom_point( data=Temperature, aes(x=longitude, y=latitude) ) + \n  labs( fill=\"°C\", x=\"Longitude\", y=\"Latitude\" )\n```\n\n::: {.cell-output-display}\n![](analysis_of_german_temperature_data_files/figure-html/unnamed-chunk-19-1.png){fig-align='center' width=100%}\n:::\n:::\n\n",
    "supporting": [
      "analysis_of_german_temperature_data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}