{
  "hash": "d3ed3b69d6ede3a81f404bcb93b35d45",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"MA22019 - Combining data frames\"\nauthor: \"Christian Rohrbeck\"\ndate: \"12 February 2025\"\n---\n\n\n\n## Plan for Today\n\nSo far we have analyzed a single complex data frame using the dplyr R package.\n\nToday we explore \n\n- how we can combine multiple data frames (Section 1.3)\n\n- the elements of a plot (Sections 2.1.1 and 2.1.2)\n\n- visualizing data using ggplot2 (Section 2.2)\n\n\n# Combining Data Sets\n\n## Motivation\n\nLet's revisit the river flow data for Bathford\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(lubridate)\nBathford <- read.csv(\"data/bathford_river_flow.csv\", skip=20, header=FALSE,\n                      colClasses = c(\"character\",\"numeric\",\"NULL\") )  %>%\n  rename( Date = V1, RiverFlow = V2 ) %>%\n  mutate( Date = as_date( Date, format=\"%Y-%m-%d\" ) )\nglimpse( Bathford )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 19,697\nColumns: 2\n$ Date      <date> 1969-10-27, 1969-10-28, 1969-10-29, 1969-10-30, 1969-10-31,…\n$ RiverFlow <dbl> 3.998, 3.958, 4.210, 4.480, 4.205, 3.830, 3.723, 3.986, 4.35…\n```\n\n\n:::\n:::\n\n\n## Reporting Missing Data\n\nWhen we work with real-world data, we have to check whether data are missing.\n\nIf there is missing data, you should report the amount of missing data!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBathford %>% \n  summarize( \"Proportion Missing\" = mean( is.na(RiverFlow) ) )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Proportion Missing\n1        0.006244606\n```\n\n\n:::\n:::\n\n\nWe see that river flow is missing for about 0.6% of days.\n\n\n\n## Combining data sets with dplyr\n\n**How can we add data from other gauges to the data frame?**\n\nThe dplyr package offers four functions to combine data frames based on matching values, which we call the \"key(s)\".\n\n- inner_join()\n\n- full_join()\n\n- left_join()\n\n- right_join()\n\nThe functions differ in terms of observations kept.\n\n\n## Example - Loading the data\n\nLet's load the river flow data for another gauge:\n\n::: {.cell}\n\n```{.r .cell-code}\nBath <- read.csv(\"data/bath_river_flow.csv\", skip=19, header=FALSE,\n                  colClasses = c(\"character\",\"numeric\",\"NULL\") )\nBath <- Bath %>% rename( Date = V1, RiverFlow = V2 ) %>%\n  mutate( Date = as_date( Date, format=\"%Y-%m-%d\" ) )\nglimpse( Bath )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 17,196\nColumns: 2\n$ Date      <date> 1976-09-01, 1976-09-02, 1976-09-03, 1976-09-04, 1976-09-05,…\n$ RiverFlow <dbl> 3.39, 2.83, 2.97, 2.81, 2.90, 2.81, 2.59, 3.11, 2.78, 2.46, …\n```\n\n\n:::\n:::\n\n\n\n## Example - Comparing the data sets\n\nLet's check the first elements of each data set\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslice_head( Bath, n=2 )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Date RiverFlow\n1 1976-09-01      3.39\n2 1976-09-02      2.83\n```\n\n\n:::\n\n```{.r .cell-code}\nslice_head( Bathford, n=2 )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Date RiverFlow\n1 1969-10-27     3.998\n2 1969-10-28     3.958\n```\n\n\n:::\n:::\n\n\n**What do we notice?**\n\n\n## Example - Merging the data sets \n\n\nLet's merge observations based on **Date**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRF <- full_join( Bathford, Bath, by=c(\"Date\" = \"Date\") )\nslice_head(RF, n=1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Date RiverFlow.x RiverFlow.y\n1 1969-10-27       3.998          NA\n```\n\n\n:::\n:::\n\n\n\n\nWe see that the variable names need updating:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRF <- rename( RF, Bathford = RiverFlow.x, Bath = RiverFlow.y )\n```\n:::\n\n\n\n## Example - Data analysis\n\nWe explore dependence of the river flow levels\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](02_combining_data_frames_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n## Comparison with inner_join()\n\nWhile full_join() keeps all observation, inner_join() only keeps the dates listed in both data sets\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRF <- inner_join( Bathford, Bath, by=c(\"Date\" = \"Date\") )\nslice_head(RF, n=3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Date RiverFlow.x RiverFlow.y\n1 1976-09-01       2.811        3.39\n2 1976-09-02       2.560        2.83\n3 1976-09-03       2.337        2.97\n```\n\n\n:::\n:::\n\n\n## Remarks \n\n\n- left_join() and right_join()\n\n\n\n- Combining a large number of data sets <br> -> **for loop** (Section 1.3.2)\n\n\n\n- Order of elements after merging\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRF <- full_join( Bath, Bathford, by=c(\"Date\" = \"Date\") )\nslice_head( RF, n=1 )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Date RiverFlow.x RiverFlow.y\n1 1976-09-01        3.39       2.811\n```\n\n\n:::\n:::\n\n\n\n\n## Key Messages\n\nWe have now finished the chapter on **Data Wrangling**. The take-home messages are\n\n* Ensure that variables are of the correct type and use informative variable names\n\n* Use the dplyr package to structure and manipulate your data\n\n* The restructuring process should be determined by the research question\n\n* Check for missing data and report the proportion if data are missing\n\n",
    "supporting": [
      "02_combining_data_frames_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}