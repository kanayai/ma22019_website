---
title: "Problem Class 3"
author: "Dr. Karim Anaya-Izquierdo"
format: html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(lubridate)
library(ggplot2)
library(tidyr)
```


## Background

The Utopian Fire Department has gathered data on their activities for 2022. They also managed to provide us with access to some data for the houses in Utopia. We are asked to use the data to address the following questions:

1) For each cause, explore how the frequency of fires varied across the time of day.

2) Are there any differences in the risk of fire for the different types of property? 

3) What is the relation between the year a property was built and the risk of fire?

We will explore how we can apply the techniques seen so far to address the three questions. 


## Data Descriptions

We are provided with two data files for the analysis:

**Data/Fires.csv**: List of fires recorded by the Utopian Fire Department for 2022

* **Date**: Day and time the fire was reported

* **Cause**: Cause the fire was attributed to ("Cooking", "Electrical Fault", "Heating" or "Other")

* **RegisterNumber**: Identification number of the property as listed in the register of houses/properties

**Data/Housing Register.csv:** Register of houses/properties for Utopia at the beginning of 2022

* **ID**: Identification number of the property

* **Year**: Year the property was built

* **Type**: Type of property ("Flat", "Terraced", "Semi-detached" or "Detached")

* **Bedroom**: Number of bedrooms (studio apartments are counted as having 1 bedroom)


## Number of fires over time

We start by loading the data set "Data/Fires.csv" and converting the variable **Date** to the correct type:

```{r}
Fires <- read.csv("data/fires.csv" )
Fires <- Fires %>% mutate( Date = ymd_hm( Date ) )
```

```{r}
glimpse( Fires )
```

**Task 1:** Create a facet plot, where each subplot provides a histogram of the number of fires per hour of the day for a different cause.

```{r}
ggplot( Fires, aes( x=hour(Date) ) ) + 
  geom_histogram( bins=24 ) + coord_polar() + 
  facet_wrap( ~Cause ) + labs( x="Hour of the Day", y="Number of Fires")
```


**Task 2:** What do you conclude from your plot produced in Task 1?


## Fire risk across type of property

We now move onto analyzing the risk of fire.

**Task 3:** How would you define "risk of fire" in this context?

One way is to consider the proportion of properties that reported fire amongst a subset of
properties.


Let's load the data from the housing register and combine the two data sets

```{r}
Houses    <- read.csv( "Data/Housing Register.csv" )
Fire_Risk <- full_join( Fires, Houses, by=c("RegisterNumber"="ID") )
```

```{r}
glimpse(Fire_Risk)
```

```{r}
Fire_Risk[1000000,]
```

**Task 4:** Create a variable to indicate whether a house was affected by a fire in 2022 or not.

```{r}
Fire_Risk <- Fire_Risk %>%
  mutate( Fire = case_when( is.na(Date) == TRUE ~ 0, is.na(Date) == FALSE ~ 1 ) )
```


**Task 5:** For each type of property, calculate the proportion of properties which reported a fire in 2022. What do you conclude?

```{r}
Fire_Risk %>% 
  group_by( Type ) %>%
  summarise( Proportion = round( mean(Fire),4 ) )
```

The lowest proportions of 0.8% are observed for Detached and semi-detached properties, while 1.1% of terraced houses reported a fire.


**Task 6:** Explore whether some causes of fire are more frequent for certain types of property.


## Relation between risk of fire and year built

**Task 7:** Create a data graphic to explore the relation between risk of fire and the year a property was built. What do you conclude?

```{r}
ggplot( Fire_Risk, aes(x=Year, y=Fire) ) + 
  geom_smooth() + facet_wrap( ~Type ) + 
  labs( x="Year Built", y="Fire Risk" )
```


