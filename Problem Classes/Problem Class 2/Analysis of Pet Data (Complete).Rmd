---
title: "Problem Class 2 - Solution"
author: "Analysis of Pet Data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(lubridate)
library(ggplot2)
library(patchwork)
```

## Background

The Utopian charity *Respect for Pets* has collected data on cats and dogs for 1990-2023. Utopia only allows three dog breeds: Beagle, Dachshund and Maltese. In Utopia all pets have to be registered. The charity would like to gain some insight regarding the following questions:

1) How have the numbers of dogs and cats changed over time? 

2) How has the popularity of the different dog breeds evolved since 1990?

3) Maltese are known to experience respiratory issues, such as wheezing or asthma. How does temperature affect the risk of a Maltese experiencing these issues?

This problem class is inspired by a question on last year's MA20277 Coursework 1, which almost used the exact same data. We will explore how we can apply the techniques seen so far to solve the three questions. 

## Data Descriptions

We are provided with two data files for the analysis:

**Pets.csv**: Information on the number of registered pets at the beginning of each month for January 1990 until September 2023:

* **Year**, **Month**: Year and month

* **Beagles**: Number of beagles

* **Dachshund**: Number of dachshunds 

* **Maltese**: Number of Maltese

* **Cats**: Number of cats


**Cases.csv:** Number of Maltese treated by a vet for respiratory issues for 1990-2022:

* **Date**: Date (day, month and year)

* **Temperature**: Daily maximum temperature in degree Celsius

* **Number**: Number of Maltese admitted with respiratory issues


##  Number of dogs and cats over time

We start by loading the data into our R Workspace using the read.csv() function and looking at the loaded data,

```{r}
Pets <- read.csv("Pets.csv")
glimpse( Pets )
```

**Task 1:** Which type of plot may be useful to explore how the numbers of dogs and cats have changed over time? 

<p style="color:blue">*A line plot is the best choice here, as we study how a variable has changed over time.*</p>

Before we create the plot, we need to do some data cleaning and wrangling. We start by converting the information on year and month into a variable of type **Date**. We can use the function **ym()** from the lubridate package for this:

```{r}
Pets <- Pets %>% 
  mutate( Date = paste( Year, Month, sep="-" ) ) %>%
  mutate( Date = ym( Date ) )
```

Since we want to plot the total number of dogs, we further create a variable **Dogs** which contains this information:

```{r}
Pets <- Pets %>% mutate( Dogs = Beagles + Dachshund + Maltese )
```

**Task 2:** Produce a plot which illustrates how the numbers of cats and dogs have changed over time. 

<p style="color:blue">*We create two line plots with different shape and colour:*</p>

```{r, fig.align='center', out.width='60%', fig.height=3, fig.width=5}
ggplot( Pets, aes("x"=Date) ) + 
  geom_line( aes( "y"=Dogs, color="Dogs" ) ) + 
  geom_line( aes( "y"=Cats, color="Cats"), linetype=2 ) +
  labs( x="Year", y="Number" ) +
  scale_colour_manual( name="Pet", values=c("Dogs"="red","Cats"="blue") )
```

<p style="color:blue">*The last line manipulates the legend such that it has a nice name ("Pets" insetad of "colour").*</p>


**Task 3:** What do we conclude from the plot produced in Task 2?

* <p style="color:blue">*There were more cats than dogs until 2015, but since then there are more dogs than cats.*</p>

* <p style="color:blue">*The number of dogs has steadily increased from around 265,000 to 315,000 in 2023.*</p>  

* <p style="color:blue">*The number of cats increased from about 283,000 in 1990 to around 305,000 in 2000-2005 and has since then been on the decline. For 2023, the number of registered cats is about 275,000.*</p>  


## Popularity of dog breeds

We now turn our attention to the second research question.

**Task 4:** How would you define popularity of a dog breed?

<p style="color:blue">*Focusing on the number of dogs is not ideal, because the overall number of dogs has increased over time. As such, there may more dogs of one breed, but its popularity may be lower. Therefore, we explore the proportion of the three breeds (among the dog population):*</p>  

```{r}
Pets <- Pets %>% 
  mutate( BeaglesPopularity = Beagles / Dogs,
          DachshundPopularity = Dachshund / Dogs,
          MaltesePopularity = Maltese / Dogs )
```

**Task 5:** Create a plot (or plots) to explore how popularity for the three different dog breeds has evolved over time.

<p style="color:blue">*We again create a line plot. We can either plot all three breeds in the same plot or create a separate plot for each breed. To create separate plots, we use the* **patchwork** *R package (it allows us to place plots next to each other using the "+" sign):* </p>

```{r, fig.height=3, fig.width=9, out.width='95%'}
g1 <- ggplot( Pets, aes( "x"=Date, "y"=BeaglesPopularity ) ) +
  geom_line() + labs( title="Beagle", x="Year", y="Proportion of Beagles" )
g2 <- ggplot( Pets, aes( "x"=Date, "y"=DachshundPopularity ) ) +
  geom_line() + labs( title="Dachshund", x="Year", y="Proportion of Dachshunds" )
g3 <- ggplot( Pets, aes( "x"=Date, "y"=MaltesePopularity ) ) + 
  geom_line() + labs( title="Maltese", x="Year", y="Proportion of Maltese" )
g1 + g2 + g3
```

**Task 6:** What do you conclude from your plot(s) created in Task 5?

* <p style="color:blue">*Dachshunds have been the most popular breed throughout the period 1990-2023. The proportion of dachshunds has grown from about 41% in 1990 to 43% in 2023.*</p> 
* <p style="color:blue">*Beagles have become slightly less popular over the period 1990-2023: the proportion was 31.5% in 1990 and is 29.5% today.*</p> 

* <p style="color:blue">*Popularity of Maltese reached its peak between 2005 and 2015 and has been decreasing ever since - itâ€™s even lower than in the 1990s.*</p>

## Effect of temperature on respiratory issues

The file "Cases.csv" provides information on the daily temperature and number of Maltese with respiratory issues. So we start by loading this file:

```{r}
Cases <- read.csv( "Cases.csv", header=TRUE )
```

**Task 7:** Explain why plotting the daily temperature against the number of dogs admitted with respiratory issues is not a good approach. What may be a better approach to address this question?

<p style="color:blue">*When plotting the reported number of Maltese with respiratory issues, we ignore that the number of Maltese in the population has changed over time. A better approach is to instead consider the proportion of Maltese treated by a vet for respiratory issues.*</p>

One possible approach is the following:

```{r, fig.align='center', out.width='60%', message=FALSE, fig.height=4, fig.width=6}
Maltese <- Pets %>% select( Year, Month, Maltese )

Cases <- Cases %>% 
  mutate( Year=year(Date), Month=month(Date) ) %>%
  full_join( Maltese, by=c( "Year"="Year", "Month"="Month" ) ) %>%
  mutate( Proportion = Number / Maltese )

ggplot( Cases, aes(x=Temperature, y=Proportion) ) + 
  geom_point() + geom_smooth() + 
  labs( y="Proportion of Maltese with respiratory issues" )
```

**Task 8:** What do we conclude from the plot? Which assumptions did we make in our analysis?

<p style="color:blue">*The lowest risk for respiratory issues is observed around 5 degree Celsius. The risk slowly increases with increasing temperature over the range 5 to 30 degree Celsius, and then increases noticeably beyond 30 degree Celsius. For lower temperatures, the highest risk is observed for negative temperatures. Consequently, Maltese are at a higher risk on days with very low or very high maximum daily temperature.*</p>

<p style="color:blue">*Regarding the assumptions underlying our conclusion, consider the following two aspects:*</p> 

1) *Is the data comparable for all years, e.g., does the population of Maltese have the same characteristics all the time?*

2) <p style="color:blue">*How quickly do we assume the issues to be reported to the vet?*</p>

