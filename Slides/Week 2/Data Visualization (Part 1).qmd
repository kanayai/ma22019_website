---
title: "MA22019 - Data Visualization (Part 1)"
author: "Christian Rohrbeck"
date: "12 February 2025"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
colorize <- function(x, color="blue") {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color,
      x)
  } else x
}
```

## Motivation 


Data exploration requires `r colorize("generating and analyzing plots of the data", "blue")`.


This raises the questions:

* What are the general guidelines for data visualization?

* How can we create effective plots in R?

* How do we decide which plot to produce?

<p style="color:Blue">**Poor graphics will prevent us from clearly communicating our findings.**</p>


## Important

We are not aiming to impress others with beautiful pictures:

```{r, echo=FALSE, fig.align='center', out.width = '90%'}
knitr::include_graphics("Dilbert.gif")
```

# A framework for data graphics

## The four elements of a plot

We will describe and produce data graphics in terms of four elements:

- Visual cues

- Coordinate system

- Scales

- Context

Today we focus on visual cues.


## Visual cues

We consider nine distinct visual cues

* `r colorize("Position")` (quantity)

* `r colorize("Length")` (quantity)

* `r colorize("Angle")` (quantity)

* `r colorize("Direction")` (quantity)

* `r colorize("Shape")` (category)

* `r colorize("Area")` and `r colorize("Volume")` (quantity)

* `r colorize("Shade")` and `r colorize("Colour")` (quantity or category)

## Example 

<p style="color:Blue">**Which visual cues are used in the following plot?**</p>

```{r, fig.align='center', out.width='65%', warning=FALSE}
library(lubridate, warn.conflicts = FALSE)
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
diving        <- read.csv( "Freediving Records.csv" )
diving$date   <- as_date( diving$date, format="%d/%m/%Y" )
diving$record <- as.numeric( diving$record )
DYN           <- filter( diving, discipline == "DYN" )
ggplot( DYN, aes( x=date, y=record, shape=sex, colour=sex ) ) +
  geom_point( size=3 ) + geom_step() + 
  labs( x="Date", y="Record in meters" ) +
  theme( axis.title = element_text(size=13),
         legend.text = element_text(size=11),
         legend.title = element_text(size=14) )
```


<p style="color:Blue">**Which conclusions can we draw?**</p>


# Creating plots in ggplot2

## Data

Daily weather data for five Australian cities:

```{r, echo=FALSE, warning=FALSE, message=FALSE, out.width='70%', fig.height=4.5, fig.align='center'}
AUS_points <- 
  data.frame( lng=c(151,145,138.5,116,131 ),
              lat=c(-34,-38,-35,-32,-12.5 ),
              name=c("Sydney", "Melbourne", "Adelaide", "Perth","Darwin"))

library( leaflet )
map <- leaflet() %>% 
  setView(lng = 130, lat = -25.3601, zoom = 4)
map %>% addTiles() %>% 
 addMarkers(data = AUS_points,
            ~lng, ~lat, 
            label = ~name )
```


## The plots we consider

We will today consider the following plots and produce them using ggplot2:

* Scatter plot

* Line plot

* Histogram and density plot

* Box plot and violin plot


<p style="color:Blue">**Which of these have you heard of?**</p>



## Density Plot

Given data $x_1,\ldots,x_n$ for a random variable $X$, we estimate the probability density function of $X$ as
\[
\hat{f}(x) = \frac{1}{nh}\sum_{i=1}^{n} K\left(\frac{x-x_i}{h}\right),
\]

* $K$ is called the **kernel** and it is a probability density function

* $h$ is the **bandwidth**

## Importance of bandwidth

```{r, out.width='90%', warning=FALSE, message=FALSE, fig.align='center', fig.height=4, fig.width=9, echo=FALSE}
library(patchwork)
set.seed(2000)
x   <- rnorm( 100, mean = 10, sd = 1 )
y   <- rgamma( 100, shape = 10, rate = 1 )
obs <- data.frame( "x"=x, "y"=y )

g  <- ggplot( obs, aes( x=y ) )
g1 <- g + geom_density( bw=0.2,size=0.6 ) + geom_rug() + 
  ylim(0,0.22) + labs(x="Value of Y", title="h=0.1") +
  theme( axis.title = element_text(size=14) ) + theme_bw()
g2 <- g + geom_density( bw=1.0,size=0.6, ) + geom_rug() + 
  ylim(0,0.22) + labs(x="Value of Y", title="h=1.0") +
  theme( axis.title = element_text(size=14) ) + theme_bw()
g3 <- g + geom_density( bw=5.0,size=0.6 ) + geom_rug() + 
  ylim(0,0.22) + labs(x="Value of Y", title="h=5.0") +
  theme( axis.title = element_text(size=14) ) + theme_bw()
g1+g2+g3
```

* A too small $h$ leads to undersmoothing (left)

* A too large $h$ leads to oversmoothing (right)

## Histogram vs Density plot

```{r, out.width='90%', warning=FALSE, message=FALSE, fig.align='center', fig.height=4, fig.width=7, echo=FALSE}
g1 <- ggplot( obs, aes( x ) ) + 
  geom_histogram( bins=20, aes(y = ..density..) ) + 
  ylim( c(0, 0.6) ) + labs( x="Value of X" ) +
    theme( axis.title = element_text(size=17), 
           axis.text = element_text(size=14) ) + theme_bw()
g2 <- ggplot( obs, aes( x ) ) + geom_density(size=0.8) + 
  ylim( c(0, 0.6) ) + labs( x="Value of X" ) +
    theme( axis.title = element_text(size=17), 
           axis.text = element_text(size=14) ) + theme_bw()
g1 + g2
```

## Which plot should I choose?

While the following guidance may not always give the best choice, it often works fine in practice:

**Scatter plots:** Useful to compare the relation between two variables.

**Line plots:** Useful to explore how a variable evolves over time.

**Histogram/Density plots:** Good for exploring the distribution of a variable.

**Box plots/Violin plots:** Good to compare the distributions of multiple variables.


## Exercises 


Decide which plot(s) to use in the following situations:

1. Association between amount of exercise and sleep.

2. Distribution of annual maximum temperature for Bath.

3. Impact of insulation on energy consumption.


Is **length** or **position** better in terms of our ability to perceive differences in magnitude?



## Summary

- Data graphics can be described in terms of visual cues

- Visual cues differ in how easy it is to perceive differences in magnitude

- We should not rely too much on colour as a visual cue

- Various types of plots can be produced in ggplot2

<p style="color:Blue">**What next?**</p>

* On Friday we apply these techniques to another data set. 

* The remaining visual cues are covered next week.