---
title: "Solutions for Quiz 3"
author: "Working with dplyr and ggplot2"
output:
  html_document: default
  pdf_document: default
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Before starting the questions, please make sure to load the relevant R packages: 

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(lubridate)
library(ggplot2)
library(patchwork)
```

### **Exercise 1 - Identifying visual cues**

An analysis of the Australian weather data, considered in the lecture, produced the following plot:

```{r, echo=F, out.width='83%', fig.height=3, fig.width=7, fig.align='center'}
AUS      <- read.csv("WeatherAustralia.csv" )
AUS$Date <- as_date( AUS$Date, format="%d/%m/%Y" )
MS       <- filter( AUS, Location %in% c("Darwin","Sydney") )
ggplot( MS, aes( x=Date, y=Rainfall ) ) + facet_wrap(~Location) +
  geom_step( aes(linetype=Location, colour=Location) ) +
  labs( y="Amount of Rainfall")
```

Identify the visual cues used in the plot and submit your answers via the quiz on Moodle.

<p style="color:blue">*One may argue that the following visual cues have been used:*</p>

* <p style="color:blue">**Position** *to indicate whether observations are earlier or later in the year.*</p>

* <p style="color:blue">**Length** *to facilitate a comparison between days*.</p>

* <p style="color:blue">**Colour** *and* **shape** *(line type) to separate the two cities*.</p>


### **Exercise 2 - Temperatures for Rio de Janeiro and Sao Paulo**

The files "Rio Temperature.csv" and "Sao Paulo Temperature.csv" contain monthly average temperature measurements for Rio de Janeiro and Sao Paulo in Brazil. Missing values in the data matrix are stored as $\mathrm{\texttt{NA}}$. 

a) Join the temperature data for Sao Paulo and Rio de Janeiro into a single data frame using full_join(). Each row in this new data frame should provide the year, month and the monthly average temperatures for Rio de Janeiro and Sao Paulo. Rename any variables that have uninformative names.

<p style="color:blue">*We first load the two data sets:*</p>

```{r}
Rio <- read.csv( "Rio Temperature.csv" )
SaoPaulo <- read.csv( "Sao Paulo Temperature.csv" )
```

<p style="color:blue">*We then apply full_join() to merge the two data sets, and data points are to be merged based on both year and month:*</p>

```{r}
Temperature <- full_join( SaoPaulo, Rio, by=c("YEAR"="YEAR", "MONTH"="MONTH") )
```

<p style="color:blue">*The variable names for the temperature values are uninformative, and we replace them with the names of the cities:*</p>

```{r}
Temperature <- Temperature %>%
  rename( "SaoPaulo" = TEMPERATURE.x, "Rio" = TEMPERATURE.y )
```

b) Using the data frame produced in part a), answer the following two questions and submit your answers via the quiz on Moodle:

(i) What was the monthly average temperature for Rio de Janeiro when Sao Paulo recorded its highest monthly average temperature?
  
<p style="color:blue">*One way is to sort the data based on the temperature for Sao Paulo and to then extract the first entry: *</p>
  
```{r}
Temperature %>%
  arrange( desc(SaoPaulo) ) %>%
  slice_head( n=1 )
```

<p style="color:blue">*So the answer we are looking for is 28.95 degree Celsius.*</p>
  

(ii) What was the largest difference in the monthly average temperatures for Sao Paulo and Rio de Janeiro?
    
<p style="color:blue">*We first calculate the absolute value of the difference for each month with mutate and then use summarise() to find that the maximum value of this new variable is 5.44: *</p>
    
```{r}
Temperature %>%
  mutate( Difference = abs( SaoPaulo - Rio ) ) %>%
  summarise( "Maximum Difference" = max( Difference, na.rm = TRUE ) )
```
    



### **Exercise 3 - Weather in New York City in 2019**

The file "NYC Weather 2019.csv" provides daily weather data for 2019 for New York City. We are given the following variables:

* **Date:** Day of the recording

* **Tmin, Tmax:** Minimum and maximum temperature in degree Fahrenheit

* **Precipitation:** Amount of precipitation in inches

Consider the following tasks. You can submit your answers to parts c) and e) via the quiz on Moodle.

a) Create a density plot to visualize the distribution of the maximum daily temperature.

<p style="color:blue">*Let's first load the data*</p> 

```{r}
NYC <- read.csv( "NYC Weather 2019.csv" )
```

<p style="color:blue">*We then use the functions ggplot() and geom_density() introduced in the lecture:*</p> 

```{r, fig.align='center', out.width='45%', fig.height=4, fig.width=6}
ggplot( NYC, aes( x=Tmax ) ) + 
  geom_density() + labs( x="Maximum daily temperature in Fahrenheit" )
```


b) Similar to Section 2.2.3. in the lecture notes, create a line plot of day of year against amount of precipitation on that day.

<p style="color:blue">*An inspection of the data shows that we need to convert the variable* **Date** *to its correct type*</p> 

```{r}
NYC <- NYC %>% mutate( Date = as_date( Date, format="%d/%m/%Y") )
```

<p style="color:blue">*We can now use ggplot2 to create a line plot. We can use either geom_line() or geom_col() in this case:*</p> 

```{r, fig.align='center', out.width='50%', fig.height=4, fig.width=6}
ggplot( NYC, aes( x=Date, y=Precipitation ) ) + 
  geom_col() + labs( y="Precipitation in inches" )  
```



c) Identify the date for which the difference in recorded daily minimum and maximum temperatures was at its highest in 2019. Enter your answer in the Day/Month format via the quiz on Moodle.

<p style="color:blue">*We first create a new variable which represents the difference in minimum and maximum temperature on the day:*</p> 

```{r}
NYC <- NYC %>% mutate( Difference = Tmax - Tmin )
```

<p style="color:blue">*To pinpoint the date, we use functions from the dplyr package:*</p>

```{r}
NYC %>%
  arrange( desc(Difference) ) %>%
  slice_head( n=1 )
```

<p style="color:blue">*We find that highest average difference in daily minimum and maximum temperature for 2019 occurred in July.*</p>


d) Create a plot which per month provides a box plot for the maximum daily temperature. **Hint:** Use the function month() to extract the month from a date and then apply the function factor() to convert it to a categorical variable.

<p style="color:blue">*The first step is to create a new variable in the data frame which represents the month of the observation. We apply the functions mentioned in the question text as follows:*</p>

```{r}
NYC <- NYC %>% mutate( Month = factor( month(Date) ) )
```

<p style="color:blue">*We then use the function geom_boxplot() from the lecture to produce for each momth a boxplot for the daily maximum temperature:*</p>

```{r, fig.align='center', out.width='60%', fig.height=4, fig.width=6}
ggplot( NYC, aes(x=Month,y=Tmax) ) + geom_boxplot() + 
  labs( x="Month", y="Maximum daily temperature in Fahrenheit" )
```  


e) Answer the following two questions and submit your questions via the quiz on Moodle:

(i) Which month had the highest median daily maximum temperature according to your plot in part d)?

<p style="color:blue">*Since the box plot visualizes, amongst others, the median value, we conclude that July recorded the highest median in terms of daily maximum temperature.*</p>

(ii) We learned that box plots should usually be ordered based on a criteria, such as the median. Should this approach also be taken for the box plot you created in part d)?

<p style="color:blue">*No, it's better to keep the plot as it is presented in part d). In general, we should not reorder the categorical variables when they are ordinal, i.e., when there is a logical ordering to them. Another example would be star ratings - in this case we also should not change the order of the variables. For the example above, not changing the order of the months makes it, for instance, easier to visualize seasonal effects.*</p>



