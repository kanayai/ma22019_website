---
title: "MA22019 2025 - Solutions for Quiz 7"
author: "Visualization of point-referenced data and inverse distance weighting"
output:
  html_document: default
  pdf_document: default
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

You may want to load the following packages before starting the exercises:

```{r, message=FALSE, warning=FALSE}
library( dplyr )
library( ggplot2 )
library( sf )
library( ggspatial )
library( prettymapr )
```

### **Exercise 1 - Types of spatial data**

For each of the following applications, decide whether the data will be point-referenced, point pattern or lattice/areal data: 

a) Occurrence of tornadoes across Europe

<p style="color:blue"> *The locations at which tornadoes occur are unknown/random and thus we will likely have point pattern data.*</p>

b) Air pollution levels across a city

<p style="color:blue"> *We may have information from measurement stations across the city. The locations of the measurement stations will be known and our variable of interest is the concentration of pollutants. Consequently, we have point-referenced data.*</p>

c) Strength of mobile phone signal

<p style="color:blue"> *Such data could be collected by measuring signal strength at a number of fixed locations. This would then give point-referenced data.*</p>

d) Damage caused by the great spruce bark beetle across Western England

<p style="color:blue"> *It is not feasible to investigate each individual tree. Instead, we will be given information on whether a woodland area is affected by the bark beetle or not. This would result in lattice / areal data.*</p>

e) Sightings of Type Ia supernova

<p style="color:blue"> *The locations of Type Ia supernova are unknown and we thus will have point pattern data. This is one application of spatial data analysis which does not consider observations located on earth. This results in a coordinate system different to the latitude/longitude system considered in most examples.*</p>


### **Exerise 2 - Rainfall across New Zealand**

The file "NewZealandRain.csv" provides the aggregated rainfall between 01/09/2019 and 30/11/2019 for various locations across New Zealand. A shapefile for New Zealand is provided in the file "ShapeFileNZ.Rdata".

a) Load the shapefile and create a plot of New Zealand. 

<p style="color:blue"> *We load and plot the data as we did for the shapefile of Germany in Section 4.1.2 of the lecture notes:*</p>

```{r, out.width='80%', fig.height=4, fig.width=7, fig.align='center'}
NewZealand <- read_sf( "Shapefiles/NZ.shp" )
ggplot( NewZealand ) + geom_sf() + theme_bw() + 
  labs( x="Longitude", y="Latitude" )
```

b) Load the data in "NewZealandRain.csv". Add points to the plot in part a) which represent the locations contained in "NewZealandRain.csv", and use the visual cue colour to visualize the amount of precipitation on logarithmic scale recorded at the various locations

<p style="color:blue"> *We first load the weather observations:*</p>

```{r}
Rain <- read.csv( "NewZealandRain.csv" )
```

<p style="color:blue"> *We again slightly adapt the code from Setion 4.1.2 in the lecture notes to combine the shapefile and the points in a single plot:*</p>

```{r, out.width='80%', fig.align='center'}
ggplot( NewZealand ) + geom_sf( color="white" ) + theme_dark() + 
  geom_point( data=Rain, aes(x=lon, y=lat, color=log(precipitation) ) ) + 
  scale_color_distiller( palette="Blues", trans="reverse" ) +
  labs( x="Longitude", y="Latitude", color="Log(Precipitation)" ) 
```

c) Use inverse distance weighting with power parameter $p=2$ to estimate the amount of precipitation between 01/09/2019 and 30/11/2019 for the following two locations: (i) 177째E Longitude and 38째S Latitude; (ii) 166째E Longitude and 51째S Latitude. You should use the original data and not apply the logarithmic scale from part b). Submit your answers (to two decimal places) in the Moodle quiz.

<p style="color:blue"> *The first step is to define the IDW() function we used in Section 4.2.2:*</p>

```{r}
IDW <- function( X, S, s_star, p){
  d <- sqrt( (S[,1]-s_star[1])^2 + (S[,2]-s_star[2])^2 )
  w <- d^(-p)
  if( min(d) > 0 )
    return( sum( X * w ) / sum( w ) )
  else 
    return( X[d==0] )
}
```

<p style="color:blue"> *We then adapt the code in Section 4.2.2 to use inverse distance weighting to get estimates for the amount of precipitation at the two locations:*</p>

```{r}
coord <- cbind( Rain$lon, Rain$lat )
IDW( X=Rain$precipitation, S=coord, s_star=c(177,-38), p=2.0 )
IDW( X=Rain$precipitation, S=coord, s_star=c(166,-51), p=2.0 )
```

<p style="color:blue"> *We predict that the amount of precipitation for Location (i) was 225 mm, while it was 400mm for Location (ii).*</p>



### **Exercise 3 - Earthquakes across Japan**

The files "Japan earthquakes.csv" contains data for earthquakes which affected Japan between 2011 and 2018. The data has been collected by the United States Geological Survey. We want to use spatial data analysis to investigate the locations of the strongest earthquakes. 

a) Load the data and extract the earthquakes with a magnitude of 6 or higher. 

<p style="color:blue">*We start by loading the data*</p>

```{r}
Earthquakes <- read.csv( "Japan earthquakes.csv" )
```

<p style="color:blue">*We can now apply the filter() function from dplyr to extract the earthquakes we are interested in:*</p>

```{r}
Earthquakes_strong <- filter( Earthquakes, mag>=6.0 )
```


b) Create a map to visualize the locations and magnitude of the earthquakes extracted in part a).

<p style="color:blue">*If we use the ggspatial package, we can directly create the map:*</p>

```{r, out.width='70%', fig.align='center', message=FALSE, warning=FALSE}
ggplot( Earthquakes_strong, aes(x=longitude, y=latitude) ) + 
  annotation_map_tile( zoom=5 ) + 
  geom_spatial_point( aes( color = mag ) ) + 
  scale_color_distiller( palette="Reds", trans="reverse" ) +
  labs( x="Longitude", y="Latitude", color="Magnitude" ) + 
  theme_bw()
```


c) Go to Moodle and complete the quiz.

