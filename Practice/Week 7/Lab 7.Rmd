---
title: "MA22019 2025 - Computer Lab 7"
author: "Visualization of point-referenced data and inverse distance weighting"
output:
  html_document: default
  pdf_document: default
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### **Overview**


Tutorial Question 1 considers an example similar to that in the lecture notes, and Tutorial Question 2 focuses on the use of projections for visualizing data.



You may want to load the following packages before starting the exercises:

```{r, message=FALSE, warning=FALSE}
library( dplyr )
library( ggplot2 )
library( sf )
library( ggspatial )
library( prettymapr )
```




### **Tutorial Question 1 - Temperature across north-eastern Brazil**

The file "Brazil.csv" contains average daily temperatures between 2000 and 2021 for 149 weather stations in north-eastern Brazil. You also given a shapefile for Brazil. We want to analyze the data using the techniques for point-referenced data introduced in the lecture.  

a) Visualize the locations of the weather stations and average daily temperature using the provided shapefile. Use the functions xlim() and ylim() to zoom in on the area of Brazil the stations are located in.

b) Create a map with the ggspatial R package that illustrates the spatial locations of the weather stations and the recorded average daily temperatures. What do you conclude?

c) Use inverse distance weighting to predict average daily temperature across north-eastern Brazil. Make sure to choose a suitable power parameter. Comment on the reliability of our estimates.


### **Tutorial Question 2 - Alaskan horsehair crab landings**

In Section 4.1.3 we covered the topic of projections. The following tasks showcase one important aspect we should keep in mind when working with projections and demonstrates how we may handle it.

The data file “Crabs.csv” contains catch per unit effort (CPUE) data of commercial horsehair crab landings for various locations across the Alaskan Eastern Bering Sea for 2010-2018. CPUE is an indirect measure of the abundance of a species. We want to visualize the data using the shapefile for Alaska:

```{r}
Alaska <- read_sf( "Shapefiles/Alaska.shp" )
```

a) Create a plot of the provided shapefile. Is the WGS84 coordinate reference system being used for the plot?

We now want to explore the spatial data contained in "Crabs.csv". Run the following piece of R code

```{r, out.width='50%', fig.align='center', fig.height=4, eval=FALSE}
Crabs <- read.csv( "Crabs.csv" )
ggplot( data=Alaska ) + theme_bw() + geom_sf() + 
  geom_point( data=Crabs, aes(x=longitude, y=latitude), colour=2 ) 
```

b) Consider the data in "Crabs.csv" and discuss whether the map we produced is correct.


Let’s change the projection of the shapefile with the coord_sf() and st_crs() functions covered in Section 4.1.2:

```{r, fig.align='center', eval=FALSE}
ggplot( data=Alaska ) + theme_bw() + geom_sf() + 
  coord_sf( crs=st_crs(4326) ) + xlim(-180,-140) + 
  geom_point( data=Crabs, aes(x=longitude, y=latitude) ) 
```

c) Is this plot more realistic than that in part b)? Adapt the code such that the recorded CPUE is shown in the plot. What do you conclude from the plot?

Instead of changing the projection of the map, let's define spatial data points using the data in "Crabs.csv":

```{r, fig.align='center', out.width='50%', fig.height=4, eval=FALSE}
Crabs_map <- Crabs %>% 
  st_as_sf( coords = c("longitude", "latitude"), crs = "WGS84" )
ggplot( data=Alaska ) + theme_bw() + geom_sf() + 
  geom_sf( data=Crabs_map, aes(color=cpue) ) +
  labs( x="Longitude", y="Latitude" )
```

d) Do the locations of the points in the created plot match with the data shown in part c)? What can we learn from the considered R code about the use of projections?


