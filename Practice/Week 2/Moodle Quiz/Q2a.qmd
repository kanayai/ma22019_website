---
title: "MA22019 2025 - Solutions for Quiz 2"
author: "Dr. Karim Anaya-Izquierdo"
format:
  html: default
  pdf: default
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Before starting the exercises, make sure to load the dplyr and lubridate R packages: 

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(lubridate)
```

If you are using your own laptop, you may have to first run the code in "InstallPackages.R" (available from Moodle) to install all the packages essential for this course.

### **Exercise 1 - Functions for data wrangling**

We described that data may not be in the format required for the analysis because

-   Variable names are uninformative;

-   Data types are incompatible with available R functions;

-   We are only interested in a subset of the data.

For each of the following R functions, decide which issue they may address and submit your answers via the Moodle quiz:

a) **as_date()**

<p style="color:blue"> *The function as_date() converts a variable of type character into a variable of type* **Date**. *Therefore, it is useful when we are working with dates and the function we want to use requires that the variable is of type* **Date***, i.e., it addresses the second issue*. </p>

b) **as.numeric()**

<p style="color:blue"> *The function as_numeric() converts a variable of type character into a variable of type* **numeric**. *This function is useful when we read data as character but actually need to use it for calculations, i.e., it again addresses the second issue.*</p>

c) **filter()**

<p style="color:blue"> *The function filter() allows us to subset the data based on one or more criteria, i.e., it addresses the third issue.* </p>

d) **group_by()**

<p style="color:blue"> *The function group_by() makes it easier to access different subsets of data by grouping observations based on one (or more) variables. We can then use the summarize() function to calculate summaries for the individual groups. Consequently, this function may be used to address the third issue.*</p>

e) **rename()**

<p style="color:blue"> *When we want to change variable names, the function rename() is the easiest option. So this function is useful to deal with uninformative variable names, i.e., the first issue.*</p>

f) **slice_head()**

<p style="color:blue"> *The function slice_head() returns the first few elements of the data frame. We have to specify how many elements we want to print using the option* $\mathrm{\texttt{n=..}}$*. For instance,* $\mathrm{\texttt{n=5}}$ *prints the first five lines. As such, this function is useful if we are just interested in exploring the first few lines of a data frame, i.e. it may address the first issue.*</p>

If you are unsure about a function, you can use the **help()** function in R, or look at the cheat sheets provided on Moodle.

### **Exercise 2 - Flights from New York City airports**

The file "NYCFlights.csv" provides data for flights in 2013 that departed from any of the three main airports servicing New York City: John F Kennedy (JFK), LaGuardia (LGA) and Newark (EWR). To load the data into your R Workspace, you can use

```{r}
NYCFlights <- read.csv( "data/NYCFlights.csv" )
```

Answer the following questions using the provided data and submit your answers via the Moodle quiz:

a)  How many flights does the data set contain?

<p style="color:blue">*We can use the function glimpse() to extract the number of observations*</p>

```{r}
glimpse( NYCFlights )
```

<p style="color:blue">*The output shows that the data set contains 336,776 flights.*</p>


b) For which month were the most flights recorded?

<p style="color:blue">*We use group_by() and summarize() to extract this information*</p>

```{r}
NYCFlights %>%
  group_by( month ) %>%
  summarize( Number_of_Flights = n() )
```

<p style="color:blue">*Looking at the table, we conclude that the most flights (29,425) were recorded for July.*</p>


c)  Which plane (specified by the **tailnum** variable) departed most often from New York City airports in 2013?

<p style="color:blue">*We again use group_by() and summarise(), but now also order the planes according to their number flights, since the data contain information for a large number of planes:*</p>

```{r}
NYCFlights %>%
  group_by( tailnum ) %>%
  summarize( Number_of_Flights=n() ) %>%
  arrange( desc(Number_of_Flights) ) %>%
  slice_head( n=5 )
```

<p style="color:blue">*We have to ignore the first entry, because $\mathrm{\texttt{NA}}$ does not refer to a single plane, but to the data entries for which the tail number is not recorded. So we conclude that the plan with tail number N725MQ departed the most often from the New York City airports.*</p>

d) How often did the plane identified in part c) depart from New York airports in January?

<p style="color:blue">*One option is extract the observations for the plane N725MQ and the month of January, an to then count the number of data points in the subset:*</p>

```{r}
NYCFlights %>%
  filter( tailnum == "N725MQ", month == 1 ) %>%
  summarize( Number_of_Flights = n() )
```
<p style="color:blue">*So the plane N725MQ departed 65 times from a New York City airport in January 2013.*</p>


### **Exercise 3 - Earthquakes around the world**

The data set "Earthquakes.csv" contains the location and size of all significant earthquakes, as recorded by the National Earthquake Information Center (NEIC), which occurred worldwide between 1965 and 2016.

We can load the data using 

```{r}
Earthquakes <- read.csv( "data/Earthquakes.csv" )
```

Answer the following questions and submit your answers via the Moodle quiz:

a) In which year between 1965 and 2016 were the most earthquakes recorded?

<p style="color:blue">*We first have a look at the data using the glimpse() function*</p>

```{r}
glimpse( Earthquakes )
```

<p style="color:blue">*We see that* **Date** *is not of the correct type. We thus first use the function as_date() function from the lubridate package*</p>

```{r}
Earthquakes$Date <- as_date( Earthquakes$Date, format='%m/%d/%Y' )
```

<p style="color:blue">*We then use the group_by() and year() functions to group the observations based on the year, and count the number of entries in each group:*</p>

```{r}
Earthquakes %>% 
  group_by( year(Date) ) %>%
  summarize( "Number_Earthquakes" = n() ) %>%
  arrange( desc(Number_Earthquakes) ) %>%
  slice_head( n=2 )
```

<p style="color:blue">*We find that the most earthquakes were recorded in 2011.*</p>

b) Were more earthquakes recorded in the northern or the southern hemisphere?

<p style="color:blue">*There are multiple ways to extract the requested information. One option is to first define a new variable based on Latitude to distinguish between northern and southern hemisphere, and to then group earthquakes based on this new variable*</p>

```{r}
Earthquakes %>% 
  mutate( Hemisphere = case_when( Latitude>=0 ~ "North",
                                  Latitude< 0 ~ "South" ) ) %>%
  group_by( Hemisphere ) %>%
  summarize( "Number_Earthquakes" = n() )
```

<p style="color:blue">*We find that between 1965 and 2016 there were a larger number of earthquakes in the southern than in the northern hemisphere.*</p>

