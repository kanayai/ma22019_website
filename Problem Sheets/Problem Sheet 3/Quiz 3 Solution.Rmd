---
title: "MA22019 2025 - Solutions for Quiz 3"
author: "Data visualization with ggplot2"
output:
  html_document: default
  pdf_document: default
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### **Overview**

Exercises 1-3 help you with revising the techniques covered in Week 3. There are no tutorial and homework questions as Coursework 1 will be released at 15:00 on Friday, 21 February 2025. 

Before starting the questions, make sure to load the different packages we considered so far: 

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(lubridate)
library(ggplot2)
library(patchwork)
library(tidyr)
```

### **Exercise 1 - CO$_2$ emissions across the globe**

The file "CO2 Emissions.csv" provides the recorded daily CO$_2$ emissions across six different sectors between 1 January 2019 and 31 May 2023 for 11 countries, the EU, the rest of the world (ROW) and across and the planet (WORLD). Enter your answers to the questions below via the quiz on Moodle.

a) Which two countries recorded the highest total CO$_2$ emissions across all sectors for the considered time window?  

<p style="color:blue"> *We start by loading the data:*</p>

```{r, warning=FALSE, message=FALSE}
CO2 <- read.csv( "CO2 Emissions.csv", header=TRUE )
```

<p style="color:blue"> *We sum up all the observed values separately for each country using functions from the dplyr package: *</p>

```{r, warning=FALSE, message=FALSE}
CO2 %>%
  group_by( country ) %>%
  summarize( Total=sum( emissions) ) %>%
  arrange( desc(Total) ) %>%
  slice_head( n=5 )
```

<p style="color:blue"> *We find that China and the United States had the most emissions between 1 January 2019 and 31 May 2023 (is this a surprise?). *</p>

b) Create a pie chart that illustrates the total emissions per sector for the UK between 1 January 2019 and 31 May 2023. Which sector of the UK economy produced the most CO$_2$ emissions over the observation period?

<p style="color:blue">*We first extract the observations for the UK and then calculate the total number of emissions for each sector*</p>

```{r}
CO2_UK <- CO2 %>%
  filter( country=="UK" ) %>%
  group_by( sector ) %>%
  summarize( Total=sum(emissions) )
CO2_UK
```

<p style="color:blue">*We can now adapt the code from the lecture notes for creating the pie chart:*</p>

```{r, fig.align='center', out.width='60%', fig.width=4, fig.height=3.5}
ggplot( CO2_UK, aes( x="", y=Total, fill=sector ) ) +
  geom_col() + coord_polar( theta="y" ) + 
  labs( x="", y="Emissions" )
```

<p style="color:blue">*The pie chart shows that the sector with the most emissions was ground transport which accounted for about 30% of the recorded CO$_2$ emissions.*</p>


### **Exercise 2 - Traffic between Minneapolis and St Paul**

The file "Traffic Minnesota.csv" contains hourly data on the traffic volume for westbound I-94, a major interstate highway in the US that connects Minneapolis and Saint Paul, Minnesota. The data was collected by the Minnesota Department of Transportation (MnDOT) from 2012 to 2018 at a station roughly midway between the two cities.

The variables are

* **traffic_volume:** Hourly I-94 reported westbound traffic volume.

* **holiday:** Indicates whether the date is a US national holiday or a regional holiday (such as the Minnesota State Fair).

* **date_time:** Shows the hour of the data collected in local CST time.


a) Use the function **dmy_hm()** in the lubridate R package to convert the variable **date_time** to its correct type. Apply the function **weekdays()** to extract the day of the week and store this information as a separate variable within the data frame.

<p style="color:blue">*We start by loading the data.*</p>

```{r}
Traffic <- read.csv( "Traffic Minnesota.csv" )
```

<p style="color:blue">*We then use the functions* **dmy_hm()** *(from the lubridate package)* *and* **weekdays()** *as required*:</p>

```{r}
Traffic <- Traffic %>% mutate( date_time = dmy_hm(date_time) )
Traffic <- Traffic %>% mutate( Weekday = weekdays(date_time) )
```


```{r}
Traffic <- Traffic %>% distinct(date_time, .keep_all = TRUE)
```

```{r}
Traffic <- Traffic %>%
  group_by( Date = date(date_time) ) %>%
  mutate( holiday = holiday[1] )
```

```{r}
filter( Traffic, holiday != "None" )
```

b) Answer the following two questions using the data and submit your solutions via the Moodle quiz on Moodle:

    (i) What is the average traffic volume on a Saturday?
    
<p style="color:blue">*We can use functions from the dplyr R package here:.*</p>
    
```{r}
Traffic %>% 
  filter( Weekday=="Saturday" ) %>%
  summarize( Average = mean(traffic_volume) )
```
    
    (ii) What is the difference in average traffic volume between work days and the weekend/ a holiday?
    
<p style="color:blue">*The first step is to create a variable which represents whether an observation comes from Monday-Friday or whether it's the weekend / a holiday.*</p>

```{r}
Traffic <- Traffic %>% 
  mutate( WorkDay = case_when( Weekday == "Saturday" ~ "Weekend",
                               Weekday == "Sunday" ~ "Weekend",
                               holiday != "None" ~ "Weekend",
                               .default = "Workday" ) )
```

<p style="color:blue">*Next, we calculate the average traffic volume for the two categories:*</p>
  
```{r}
AverageTraffic <- Traffic %>% 
  group_by( WorkDay ) %>%
  summarise( Mean = mean(traffic_volume) )
```

<p style="color:blue">*Finally, we calculate the difference in the averages:*</p>

```{r}
AverageTraffic$Mean[1] - AverageTraffic$Mean[2]
```

c) Create a plot which visualizes how the traffic volume changes throughout the day on Mondays.

<p style="color:blue">*We can extract the hour using the function hour() and combine it with functions from dplyr and ggplot we are familiar with:*</p>

```{r, fig.align='center', out.width='50%'}
Traffic %>%
  filter( Weekday == "Monday" ) %>%
  ggplot( aes(x=hour(date_time), y=traffic_volume) ) + 
  geom_point() + geom_smooth() + 
  labs( x="Hour of the Day", y="Traffic Volume" )
```

### **Exercise 3 - Weather in Brisbane and Gold Coast**

The file "BrisbaneGoldCoast.csv" contains daily weather measurements for Brisbane and Gold Coast in Australia. 

a) Explore how the daily maximum temperature for Gold Coast varies throughout the year. Use the results from your analysis to answer the Moodle quiz.

<p style="color:blue">*Let's load the data:*</p>

```{r}
BrisbaneGoldCoast <- read.csv("BrisbaneGoldCoast.csv")
```

<p style="color:blue">*As we want to plot values over time, the first step is to convert the variable* **Date** *to its correct type:*</p>

```{r}
BrisbaneGoldCoast <- BrisbaneGoldCoast %>% 
  mutate( Date = as_date( Date, format="%d/%m/%Y" ) )
```

<p style="color:blue">*For this analysis we only consider Gold Coast, and we thus we select the relevant observations:*</p>

```{r}
GoldCoast <- filter( BrisbaneGoldCoast, Location=="GoldCoast" )
```

<p style="color:blue">*To explore variation throughout the year, we can create a line plot of the data:*</p>

```{r, fig.align='center', out.width='50%', fig.width=5, fig.height=3}
ggplot( GoldCoast, aes( x=Date, y=MaxTemp ) ) + 
  geom_line( ) + labs( x="Date", y="Maximum Temperature" )
```

<p style="color:blue">*The plot shows that Gold Coast observes a seasonal pattern in the maximum daily temperature, with the highest temperatures recorded around December/January.*</p>

<p style="color:blue">*We can also study the average daily maximum temperature for each month to illustrate this further:*</p>

```{r, fig.align='center', out.width='50%', fig.width=5, fig.height=3}
GoldCoast %>% 
  group_by( Month=month(Date) ) %>% 
  summarise( Mean=mean(MaxTemp, na.rm=TRUE) ) %>%
  ggplot( aes(x=Month, y=Mean) ) + geom_line() + geom_point()
```

b) Create a scatter plot of the daily maximum temperature for Brisbane and Gold Coast. What do you conclude?

<p style="color:blue">*To explore the dependence between the sites via a scatter plot, we have to change the data structure using the tidyr package. Specifically, we want the measurements for Brisbane and Gold Coast in separate columns, which we achieve using*</p>

```{r, warning=FALSE}
BGC_wide <- pivot_wider( BrisbaneGoldCoast, names_from=Location,
                         values_from=MaxTemp:WindGustSpeed )
```

<p style="color:blue">*We can now create scatter plots to analyse the dependence:*</p>

```{r, fig.align='center', out.width='40%', fig.height=4, fig.width=4}
ggplot( BGC_wide, aes(x=MaxTemp_Brisbane, y=MaxTemp_GoldCoast) ) + 
  geom_point() + 
  labs( x="Maximum Brisbane", y="Maximum Gold Coast" )
```

<p style="color:blue">*The plot shows that the daily maximum temperatures for Brisbane and Gold Coast are quite similar. This strong dependence reflects their spatial proximity.*</p>
